<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 关于 DOCTYPE 的一个小发现 · 易浮的小窝</title><meta name="description" content="关于 DOCTYPE 的一个小发现 - Hyifu"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://github.com/Hyifu/atom.xml" title="易浮的小窝"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"><h1>易浮的小窝</h1></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">关于 DOCTYPE 的一个小发现</h1><div class="post-info">Dec 18, 2015</div><div class="post-content"><p><code>&lt;!DOCTYPE html&gt;</code> 对于前端开发工程师（好吧，其实做 Web 都懂）而言，实在是太熟悉的一个东西了，由此引申的浏览器的各种模式也是一个老生常谈的坑。然而我在意外中竟然找到了一个鲜为人知的点，实在是惊讶！</p>
<a id="more"></a>
<h2 id="问题起源"><a href="#问题起源" class="headerlink" title="问题起源"></a>问题起源</h2><p>某天知乎瞎逼逛的时候，发现有一个新的问题：<a href="https://www.zhihu.com/question/38437397/answer/76617831" target="_blank" rel="external">发现html5一个很奇怪的问题…</a></p>
<blockquote>
<p>使用 XHTML 声明时，图片是完美贴合包裹 DIV 元素的<br>但使用 HTML 5 标准声明时，包裹 DIV 元素底部会被撑开 2～5 个像素不等</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"background:black;float:left"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"http://photocdn.sohu.com/20110902/Img318184717.jpg"</span> /&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"background:black;float:left"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"http://photocdn.sohu.com/20110902/Img318184717.jpg"</span> /&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>实际测试如下图所示，图片实际尺寸是（191 * 126）<br><img src="/images/DOCTYPE-diff.png" alt="DOCTYPE-diff"></p>
<h2 id="寻根问底"><a href="#寻根问底" class="headerlink" title="寻根问底"></a>寻根问底</h2><p>这就让人甚是疑惑，虽然实际开发中虽然一般重构基础过关的前端同学都知道，对于图片，一般都会使用 <code>vertical-align: middle</code> 使其与周边对齐，但是为什么使用老旧的文档声明反而是符合我们直观的显示呢？</p>
<p>本着兴趣和刨根问底的精神，我幸运地在国外程序员问答社区 <strong>stackoverflow</strong> 找到了类似的一个问答：<br><a href="http://stackoverflow.com/questions/4904668/html5-vertical-spacing-issue-with-img" target="_blank" rel="external">html5 vertical spacing issue with image tag</a></p>
<blockquote>
<p>首先，浏览器并没有所谓的“HTML 5 模式”，而是只有三种：怪异模式（Quirks)，几乎标准的模式（Limited Quirks）和标准模式（Standards），其中几乎标准的模式和标准模式之间的唯一差异在于是否对 <code>&lt;img&gt;</code> 元素给定行高（line-height）和基线（baseline）</p>
<p>几乎标准模式中，如果 <code>&lt;img&gt;</code> 标签所在行没有其他的行内元素，将不指定基线（baseline）， <code>&lt;img&gt;</code> 标签因此会紧贴着父元素底部</p>
<p>在标准模式中，行框总是会包含类似字母 <code>g</code>，<code>f</code> 尾巴下伸出来的那一部分空间（针对下行字母），即使行框内并没有任何内容。因此这种情况下你看到的 <code>&lt;img&gt;</code> 跟父元素底部几个像素的间隙实际上就是为”字母尾巴“预留的</p>
<p>使用 XHTML Transitional Doctype 会是浏览器运行在”几乎标准模式（Limited Quirks）”。如果你使用XHTML Strict 或者HTML 4 Strict模式，你将看到和使用HTML 5 模式同样的间隙，因为这是标准模式（Standards mode）</p>
</blockquote>
<p>天哪，单单一个简单的 DOCTYPE 就要牵扯出奇怪的基线问题，而这个基线仅仅又是因为英文字母会有上行字母和下行字母的对齐问题</p>
<h2 id="图片的最佳实践"><a href="#图片的最佳实践" class="headerlink" title="图片的最佳实践"></a>图片的最佳实践</h2><p>知道了前面的缘由，我们就有理由在后续的开发中找到一条最佳实践的道路了，我思考了很久，给出一条建议是加上下列的 CSS Reset</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">img</span> &#123;</div><div class="line">  <span class="attribute">max-width</span>: <span class="number">100%</span>;</div><div class="line">  <span class="attribute">max-height</span>: <span class="number">100%</span>;</div><div class="line">  <span class="attribute">vertical-align</span>: middle;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>虽然现在开发中已经不建议粗暴地加上 CSS Reset 而转为温柔的 <a href="http://necolas.github.io/normalize.css/" target="_blank" rel="external">normalize.css</a>，但我有我的理由：</p>
<p>首先，绝大部分时候你不希望图片把包裹层撑破，因此前两条规则限制了无法无天的图片撑开</p>
<p>其次，由于前面的图片对齐问题，你可能需要在所有图片都手动对齐以防出现奇怪的几个像素</p>
<h2 id="引申"><a href="#引申" class="headerlink" title="引申"></a>引申</h2><p>实际上由这个问题我联想到了实际开发中，有时会偶尔遇到包裹元素莫名比里面的元素最大值多几个像素的 BUG，直到现在我才恍然大悟！</p>
<p>图片本质上就是一个内联元素（或者说 <code>inline-block</code>，因为本身具有宽高），所以只要你在实际工作中，有若干个具备内联性质的元素水平对齐，就会出现这种情况：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrap"</span>&gt;</span></div><div class="line">  这里是文字</div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"inline"</span> <span class="attr">style</span>=<span class="string">"display: inline-block; width: 100px; height: 100px;"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>你实际看到的 <code>.wrap</code> 在不同的浏览器中高度都是略大于 100px 的，因为它给隐形的 “尾巴” 留了空间（把 <code>inline</code> 当作图片啦），真是神奇呢！</p>
</div></article></div></main><footer><div class="paginator"><a href="/2015/12/27/《JavaScript高级程序设计》阅读笔记（下）/" class="prev">PREV</a><a href="/2015/12/08/《JavaScript高级程序设计》阅读笔记（上）/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2017 <a href="https://github.com/Hyifu">Hyifu</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a></p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>